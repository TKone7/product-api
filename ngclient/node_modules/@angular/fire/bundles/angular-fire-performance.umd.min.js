!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/fire"),require("@angular/common")):"function"==typeof define&&define.amd?define("@angular/fire/performance",["exports","@angular/core","rxjs","rxjs/operators","@angular/fire","@angular/common"],r):r(((e=e||self).angular=e.angular||{},e.angular.fire=e.angular.fire||{},e.angular.fire.performance={}),e.ng.core,e.rxjs,e.rxjs.operators,e.angular.fire,e.ng.common)}(this,(function(e,r,n,t,i,u){"use strict";var c=new r.InjectionToken("angularfire2.performance.auto_trace"),o=new r.InjectionToken("angularfire2.performance.instrumentationEnabled"),a=new r.InjectionToken("angularfire2.performance.dataCollectionEnabled"),s=function(){function e(e,r,c,o,a,s,f){var b=this;return this.zone=s,this.trace$=function(e,r){return b.performance.pipe(t.switchMap((function(t){return new n.Observable((function(n){return b.zone.runOutsideAngular((function(){var i=t.trace(e);r&&r.metrics&&Object.keys(r.metrics).forEach((function(e){i.putMetric(e,r.metrics[e])})),r&&r.attributes&&Object.keys(r.attributes).forEach((function(e){i.putAttribute(e,r.attributes[e])}));var u=r&&r.attribute$?Object.keys(r.attribute$).map((function(e){return r.attribute$[e].subscribe((function(r){return i.putAttribute(e,r)}))})):[],c=r&&r.metric$?Object.keys(r.metric$).map((function(e){return r.metric$[e].subscribe((function(r){return i.putMetric(e,r)}))})):[],o=r&&r.incrementMetric$?Object.keys(r.incrementMetric$).map((function(e){return r.incrementMetric$[e].subscribe((function(r){return i.incrementMetric(e,r||void 0)}))})):[];return n.next(i.start()),{unsubscribe:function(){i.stop(),c.forEach((function(e){return e.unsubscribe()})),o.forEach((function(e){return e.unsubscribe()})),u.forEach((function(e){return e.unsubscribe()}))}}}))}))})))},this.traceUntil=function(e,r,i){return function(u){return new n.Observable((function(n){var c=b.trace$(e,i).subscribe();return u.pipe(t.tap((function(e){return r(e)&&c.unsubscribe()}),(function(){}),(function(){return i&&i.orComplete&&c.unsubscribe()}))).subscribe(n)}))}},this.traceWhile=function(e,r,i){return function(u){return new n.Observable((function(n){var c;return u.pipe(t.tap((function(n){r(n)?c=c||b.trace$(e,i).subscribe():(c&&c.unsubscribe(),c=void 0)}),(function(){}),(function(){return i&&i.orComplete&&c&&c.unsubscribe()}))).subscribe(n)}))}},this.traceUntilComplete=function(e,r){return function(i){return new n.Observable((function(n){var u=b.trace$(e,r).subscribe();return i.pipe(t.tap((function(){}),(function(){}),(function(){return u.unsubscribe()}))).subscribe(n)}))}},this.traceUntilFirst=function(e,r){return function(i){return new n.Observable((function(n){var u=b.trace$(e,r).subscribe();return i.pipe(t.tap((function(){return u.unsubscribe()}),(function(){}),(function(){}))).subscribe(n)}))}},this.trace=function(e,r){return function(i){return new n.Observable((function(n){var u=b.trace$(e,r).subscribe();return i.pipe(t.tap((function(){return u.unsubscribe()}),(function(){}),(function(){return u.unsubscribe()}))).subscribe(n)}))}},this.performance=n.of(void 0).pipe(t.switchMap((function(){return u.isPlatformBrowser(f)?s.runOutsideAngular((function(){return import("firebase/performance")})):n.empty()})),t.map((function(){return s.runOutsideAngular((function(){return e.performance()}))})),t.tap((function(e){0==c&&(e.instrumentationEnabled=!1),0==o&&(e.dataCollectionEnabled=!1)})),t.shareReplay({bufferSize:1,refCount:!1})),0!=r&&a.isStable.pipe(t.first((function(e){return e})),this.traceUntilComplete("isStable")).subscribe(),i["ɵlazySDKProxy"](this,this.performance,s)}return e.decorators=[{type:r.Injectable,args:[{providedIn:"any"}]}],e.ctorParameters=function(){return[{type:i.FirebaseApp},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[c]}]},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[o]}]},{type:void 0,decorators:[{type:r.Optional},{type:r.Inject,args:[a]}]},{type:r.ApplicationRef},{type:r.NgZone},{type:Object,decorators:[{type:r.Inject,args:[r.PLATFORM_ID]}]}]},e.ɵprov=r["ɵɵdefineInjectable"]({factory:function(){return new e(r["ɵɵinject"](i.FirebaseApp),r["ɵɵinject"](c,8),r["ɵɵinject"](o,8),r["ɵɵinject"](a,8),r["ɵɵinject"](r.ApplicationRef),r["ɵɵinject"](r.NgZone),r["ɵɵinject"](r.PLATFORM_ID))},token:e,providedIn:"any"}),e}();var f=function(){function e(e){}return e.decorators=[{type:r.NgModule,args:[{providers:[s]}]}],e.ctorParameters=function(){return[{type:s}]},e}();e.AUTOMATICALLY_TRACE_CORE_NG_METRICS=c,e.AngularFirePerformance=s,e.AngularFirePerformanceModule=f,e.DATA_COLLECTION_ENABLED=a,e.INSTRUMENTATION_ENABLED=o,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-fire-performance.umd.min.js.map