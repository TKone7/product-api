!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("rxjs"),require("rxjs/operators"),require("@angular/fire"),require("@angular/common")):"function"==typeof define&&define.amd?define("@angular/fire/firestore",["exports","@angular/core","rxjs","rxjs/operators","@angular/fire","@angular/common"],t):t(((e=e||self).angular=e.angular||{},e.angular.fire=e.angular.fire||{},e.angular.fire.firestore={}),e.ng.core,e.rxjs,e.rxjs.operators,e.angular.fire,e.ng.common)}(this,(function(e,t,r,n,i,o){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var s=function(){return(s=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function u(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,o=r.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(n=o.next()).done;)s.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return s}function a(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}function c(e,t){return function(e,t){return void 0===t&&(t=r.asyncScheduler),new r.Observable((function(r){var n;return null!=t?t.schedule((function(){n=e.onSnapshot(r)})):n=e.onSnapshot(r),function(){null!=n&&n()}}))}(e,t)}function f(e,t){return c(e,t).pipe(n.map((function(e){return{payload:e,type:"value"}})))}function p(e,t){return c(e,t).pipe(n.map((function(e){return{payload:e,type:"query"}})))}function l(e,t){return p(e,t).pipe(n.map((function(e){return e.payload.docChanges().map((function(e){return{type:e.type,payload:e}}))})))}function d(e,t,r){return p(e,r).pipe(n.map((function(e){return e.payload.docChanges()})),n.scan((function(e,r){return h(e,r,t)}),[]),n.map((function(e){return e.map((function(e){return{type:e.type,payload:e}}))})))}function h(e,t,r){return t.forEach((function(t){r.indexOf(t.type)>-1&&(e=y(e,t))})),e}function y(e,t){switch(t.type){case"added":e[t.newIndex]&&e[t.newIndex].doc.ref.isEqual(t.doc.ref)||e.splice(t.newIndex,0,t);break;case"modified":(null==e[t.oldIndex]||e[t.oldIndex].doc.ref.isEqual(t.doc.ref))&&(t.oldIndex!==t.newIndex?(e.splice(t.oldIndex,1),e.splice(t.newIndex,0,t)):e.splice(t.newIndex,1,t));break;case"removed":e[t.oldIndex]&&e[t.oldIndex].doc.ref.isEqual(t.doc.ref)&&e.splice(t.oldIndex,1)}return e}function g(e){return e&&0!==e.length||(e=["added","removed","modified"]),e}var v=function(){function e(e,t,r){this.ref=e,this.query=t,this.afs=r}return e.prototype.stateChanges=function(e){return e&&0!==e.length?l(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst,n.map((function(t){return t.filter((function(t){return e.indexOf(t.type)>-1}))})),n.filter((function(e){return e.length>0}))):l(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.auditTrail=function(e){return this.stateChanges(e).pipe(n.scan((function(e,t){return a(e,t)}),[]))},e.prototype.snapshotChanges=function(e){var t=g(e);return d(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(e){return void 0===e&&(e={}),p(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst,n.map((function(t){return t.payload.docs.map((function(t){var r;return e.idField?s(s({},t.data()),((r={})[e.idField]=t.id,r)):t.data()}))})))},e.prototype.get=function(e){return r.from(this.query.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e.prototype.add=function(e){return this.ref.add(e)},e.prototype.doc=function(e){return new m(this.ref.doc(e),this.afs)},e}();var m=function(){function e(e,t){this.ref=e,this.afs=t}return e.prototype.set=function(e,t){return this.ref.set(e,t)},e.prototype.update=function(e){return this.ref.update(e)},e.prototype.delete=function(){return this.ref.delete()},e.prototype.collection=function(e,t){var r=F(this.ref.collection(e),t),n=r.ref,i=r.query;return new v(n,i,this.afs)},e.prototype.snapshotChanges=function(){return f(this.ref,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(){return this.snapshotChanges().pipe(n.map((function(e){return e.payload.data()})))},e.prototype.get=function(e){return r.from(this.ref.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e}();var I=function(){function e(e,t){this.query=e,this.afs=t}return e.prototype.stateChanges=function(e){return e&&0!==e.length?l(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst,n.map((function(t){return t.filter((function(t){return e.indexOf(t.type)>-1}))})),n.filter((function(e){return e.length>0}))):l(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.auditTrail=function(e){return this.stateChanges(e).pipe(n.scan((function(e,t){return a(e,t)}),[]))},e.prototype.snapshotChanges=function(e){var t=g(e);return d(this.query,t,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)},e.prototype.valueChanges=function(){return p(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst,n.map((function(e){return e.payload.docs.map((function(e){return e.data()}))})))},e.prototype.get=function(e){return r.from(this.query.get(e)).pipe(n.observeOn(this.afs.schedulers.insideAngular))},e}();var b=new t.InjectionToken("angularfire2.enableFirestorePersistence"),A=new t.InjectionToken("angularfire2.firestore.persistenceSettings"),j=new t.InjectionToken("angularfire2.firestore.settings");function F(e,t){return void 0===t&&(t=function(e){return e}),{query:t(e),ref:e}}var E=function(){function e(e,t,n,s,u,a,c){var f=this;if(this.schedulers=new i["ɵAngularFireSchedulers"](a),this.keepUnstableUntilFirst=i["ɵkeepUnstableUntilFirstFactory"](this.schedulers,u),this.firestore=a.runOutsideAngular((function(){var r=i["ɵfirebaseAppFactory"](e,a,t);if(!r.firestore)throw"You must import 'firebase/firestore' before using AngularFirestore";var n=r.firestore();return s&&n.settings(s),n})),n&&!o.isPlatformServer(u)){this.persistenceEnabled$=a.runOutsideAngular((function(){try{return r.from(f.firestore.enablePersistence(c||void 0).then((function(){return!0}),(function(){return!1})))}catch(e){return r.of(!1)}}))}else this.persistenceEnabled$=r.of(!1)}return e.prototype.collection=function(e,t){var r=F("string"==typeof e?this.firestore.collection(e):e,t),n=r.ref,i=r.query;return new v(n,i,this)},e.prototype.collectionGroup=function(e,t){var r=t||function(e){return e},n=this.firestore.collectionGroup(e);return new I(r(n),this)},e.prototype.doc=function(e){var t;return t="string"==typeof e?this.firestore.doc(e):e,new m(t,this)},e.prototype.createId=function(){return this.firestore.collection("_").doc().id},e.decorators=[{type:t.Injectable,args:[{providedIn:"any"}]}],e.ctorParameters=function(){return[{type:void 0,decorators:[{type:t.Inject,args:[i.FIREBASE_OPTIONS]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[i.FIREBASE_APP_NAME]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[b]}]},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[j]}]},{type:Object,decorators:[{type:t.Inject,args:[t.PLATFORM_ID]}]},{type:t.NgZone},{type:void 0,decorators:[{type:t.Optional},{type:t.Inject,args:[A]}]}]},e.ɵprov=t["ɵɵdefineInjectable"]({factory:function(){return new e(t["ɵɵinject"](i.FIREBASE_OPTIONS),t["ɵɵinject"](i.FIREBASE_APP_NAME,8),t["ɵɵinject"](b,8),t["ɵɵinject"](j,8),t["ɵɵinject"](t.PLATFORM_ID),t["ɵɵinject"](t.NgZone),t["ɵɵinject"](A,8))},token:e,providedIn:"any"}),e}();var x=function(){function e(){}return e.enablePersistence=function(t){return{ngModule:e,providers:[{provide:b,useValue:!0},{provide:A,useValue:t}]}},e.decorators=[{type:t.NgModule,args:[{providers:[E]}]}],e}();e.AngularFirestore=E,e.AngularFirestoreCollection=v,e.AngularFirestoreCollectionGroup=I,e.AngularFirestoreDocument=m,e.AngularFirestoreModule=x,e.ENABLE_PERSISTENCE=b,e.PERSISTENCE_SETTINGS=A,e.SETTINGS=j,e.associateQuery=F,e.combineChange=y,e.combineChanges=h,e.docChanges=l,e.fromCollectionRef=p,e.fromDocRef=f,e.fromRef=c,e.sortedChanges=d,e.validateEventsArray=g,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-fire-firestore.umd.min.js.map